version: '3'
services:

  ################
  # Torrent server
  deluge:
    container_name: deluge
    image: linuxserver/deluge
    restart: always
    environment:
      - PUID=1000
      - PGID=1000
    volumes:
      - ./.deluge/config:/config
      - ./storage/done/:/storage/done/
      - ./storage/todo/:/storage/todo/
      - ./storage/progress/:/storage/progress/
      - ./storage/torrents/:/storage/torrents/
    network_mode: host

  ##############
  # Samba server
  samba:
    container_name: samba
    hostname: samba
    image: sixeyed/samba
    volumes:
      - ./storage/:/mnt/storage/
    ports:
      - "139:139"
      - "446:445"
      - "137:137/udp"
      - "138:138/udp"
    command: samba.sh -s "storage;/mnt/storage;yes;no;yes;all"
    deploy:
      resources:
        limits:
          memory: 1G
    restart: always

  ###############
  # MariaDB
  nextcloud-db:
    image: mariadb
    command: --transaction-isolation=READ-COMMITTED --binlog-format=ROW
    restart: always
    ports:
      - 3306:3306
    volumes:
      - ./.database/nextcloud/mariadb/:/var/lib/mysql
    environment:
      - MYSQL_ROOT_PASSWORD=secret
      - MYSQL_PASSWORD=password
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=nextcloud

  ###############
  # NextCloud
  nextcloud-app:
    image: nextcloud
    ports:
      - 8080:80
    links:
      - nextcloud-db
    volumes:
      - ./.nextcloud/:/var/www/html
    restart: always
